{% extends 'layout.html' %}

{% block content %}
<div class="book-card">

<main id="main" class="flexbox-col" style="background-color: var(--color-azul-marino);">
    <h1>{{ libro.titulo }}</h1>
    <img src="{{ url_for('static', filename='img/' ~ libro.img) }}" alt="{{ libro.titulo }}" style="width:150px;height:200px;">
    <p><strong>Autor:</strong> {{ libro.autor.nombre }} {{ libro.autor.apellido }}</p>
    <p><strong>Género:</strong> {{ libro.genero.nombre }}</p>
    <p><strong>Editorial:</strong> {{ libro.editorial.nombre if libro.editorial else 'Sin editorial' }}</p>
    <p><strong>Descripción:</strong> {{ libro.descripcion }}</p>
    <p><strong>fecha:</strong> {{ libro.fecha_emision if libro.fecha_emision else 'Fecha Desconocida' }}</p>
    <p><strong>Precio:</strong> ${{ libro.precio }}</p>
    <p><strong>Precio de Alquiler:</strong> ${{ libro.precio_alquiler if libro.precio_alquiler else 'N/A' }}</p>
    <p><strong>ISBN:</strong> {{ libro.isbn if libro.isbn else 'Deconocido'}}</p>
    <p><strong>Idioma:</strong> {{ libro.idioma }}</p>
    <p><strong>Edición:</strong> {{ libro.edicion }}</p>
    <p><strong>stock:</strong> {{ libro.stock }}</p>
    <p><strong>Número de Páginas:</strong> {{ libro.paginas }}</p>
    <p><strong>Formato:</strong> {{ libro.formato }}</p>
    <p><strong>Calificación promedio:</strong> {{ promedio_calificacion or 'No calificado aún' }} / 5</p>

    
            <!-- Sistema de votación con estrellas -->
            {% if "nombre" in session %}
            <h2>Vota este libro:</h2>
            <form method="POST" action="{{ url_for('votaciones.votar', libro_id=libro.id) }}">
                <div class="rating">
                    <input type="radio" id="star5" name="calificacion" value="5"><label for="star5" title="5 estrellas"></label>
                    <input type="radio" id="star4" name="calificacion" value="4"><label for="star4" title="4 estrellas"></label>
                    <input type="radio" id="star3" name="calificacion" value="3"><label for="star3" title="3 estrellas"></label>
                    <input type="radio" id="star2" name="calificacion" value="2"><label for="star2" title="2 estrellas"></label>
                    <input type="radio" id="star1" name="calificacion" value="1"><label for="star1" title="1 estrella"></label><br><br>
                </div>
                <button type="submit">Enviar votación</button>
            </form>
        {% else %}
            <p>Debes estar registrado para votar.</p>
        {% endif %}
    <!-- Formulario para solicitar un préstamo -->
    {% if "nombre" in session %}
    <!-- Si hay stock disponible -->
    {% if libro.stock > 0 %}
        <form method="POST" action="{{ url_for('prestamos.solicitar_prestamo', libro_id=libro.id) }}">
            <label for="duracion">Duración del préstamo:</label>
            <select id="duracion" name="duracion">
                <option value="15">15 días (Precio normal)</option>
                <option value="30">30 días (Doble precio)</option>
            </select>
            <button type="submit">Solicitar Préstamo</button>
        </form>
    {% else %}
        <p>No hay stock disponible para este libro.</p>
    {% endif %}

    {% endif %}
    <h3>Comentarios</h3>

{% if "nombre" in session %}
    <form method="POST" action="{{ url_for('votaciones.agregar_comentario', libro_id=libro.id) }}">
        <textarea name="comentario" placeholder="Escribe tu comentario aquí..." rows="4" required></textarea>
        <button type="submit">Comentar</button>
    </form>
{% else %}
    <p><a href="{{ url_for('user.login') }}">Inicia sesión</a> para dejar un comentario.</p>
{% endif %}

    
    
</form>

</main>
</div>
<h3>Comentarios</h3>

{% if libro.comentarios %}
    <ul>
    {% for comentario in libro.comentarios %}
        <li>
            <p><strong>{{ comentario.usuario.nombre }}:</strong> {{ comentario.comentario }}</p>
            <small>{{ comentario.fecha.strftime('%Y-%m-%d %H:%M') }}</small>
            
            <!-- Mostrar botón de eliminar si el usuario es el autor o un admin -->

            
            {% if session.get('rol') == 'admin' or session.get('usuario_id') == comentario.id_usuario %}
                <form method="POST" action="{{ url_for('votaciones.eliminar_comentario', comentario_id=comentario.id) }}">
                    <button type="submit">Eliminar</button>
                </form>
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>No hay comentarios aún. ¡Sé el primero en comentar!</p>
{% endif %}



{% endblock %}